<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Довідник дорожніх знаків</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- DEGRADED MODE BANNER -->
  <div id="degradedBanner" style="display:none; background: #e74c3c; color: white; text-align: center; padding: 10px; position: sticky; top: 0; z-index: 1000;">
    Система перевантажена. Деякі функції тимчасово недоступні.
  </div>

  <nav>
    <div class="logo">
      <img src="images/logo_road_sign.jpg" alt="Logo">
      <h2>Дорожні знаки</h2>
    </div>
    <div style="display: flex; gap: 10px;">
        <span id="userInfoDisplay" style="color: white; align-self: center; display: none;"></span>
        <button onclick="openAuthModal()">Особистий кабінет</button>
    </div>
  </nav>

  <div class="container">
    <h1>Довідник дорожніх знаків</h1>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('signs')">Дорожні знаки</button>
      <button class="tab" onclick="switchTab('users')">Користувачі</button>
    </div>

    <!-- === Знаки === -->
    <div id="signs-tab" class="tab-content active">
      <div class="controls">
        <button onclick="loadAllSigns()">Усі</button>
        <button onclick="loadSignsByCategory('Заборонні')">Заборонні</button>
        <button onclick="loadSignsByCategory('Пріоритету')">Пріоритету</button>
        <button onclick="loadSignsByCategory('Інформаційні')">Інформаційні</button>
        <button onclick="loadSignsByCategory('Попереджувальні')">Попереджувальні</button>

        <!-- Кнопки дій -->
        <button onclick="createTestSign()" style="background: #f1c40f; color: black; margin-left: 20px;">Тест</button>

        <!-- КНОПКА ДОДАТИ (Тільки для адміна) -->
        <button id="addSignBtn" onclick="openSignForm()" style="background: #27ae60; color: white; display: none;">Додати знак</button>
      </div>

      <div id="loading" style="display:none;text-align:center;">Завантаження...</div>
      <div id="signsList" class="signs-container"></div>
    </div>

    <!-- === Користувачі === -->
    <div id="users-tab" class="tab-content">
      <div class="admin-panel">
        <h2>Управління користувачами</h2>
        <button onclick="loadAllUsers()">Оновити список</button>
        <div id="usersLoading" style="display:none;">Завантаження користувачів...</div>
        <div id="usersList"></div>
      </div>
    </div>
  </div>

  <!-- === MODAL AUTH (Вхід) === -->
  <div id="authModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('authModal')">✖</span>

      <div id="authStatus" style="display:none; margin-bottom: 15px;">
        <p>Ви увійшли як: <strong id="authUsername"></strong></p>
        <button id="logout-btn" onclick="logout()" style="background: #e74c3c;">Вийти</button>
      </div>

      <div id="authForm">
        <h3>Увійти / Зареєструватися</h3>
        <input type="text" id="username" placeholder="Ім'я користувача">
        <input type="password" id="password" placeholder="Пароль">
        <button onclick="login()">Увійти</button>
        <button onclick="register()">Зареєструватися</button>
      </div>
    </div>
  </div>

  <!-- === MODAL SIGN DETAILS (Деталі знака) === -->
  <div id="detailModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <span class="close-btn" onclick="closeModal('detailModal')">✖</span>
        <h2 id="detailName">Назва знака</h2>
        <span id="detailCategory" class="category" style="font-size: 1rem;">Категорія</span>
        <hr style="margin: 15px 0; border: 0; border-top: 1px solid #ddd;">
        <p id="detailDescription" style="font-size: 1.1rem; line-height: 1.6;">Опис</p>

        <!-- Кнопки адміна в деталях -->
        <div id="detailAdminControls" style="display: none; margin-top: 20px; text-align: right;">
            <button onclick="editCurrentSign()" style="background: #f39c12;">Редагувати</button>
            <button onclick="deleteCurrentSign()" style="background: #e74c3c;">Видалити</button>
        </div>
    </div>
  </div>

  <!-- === MODAL SIGN FORM (Додавання/Редагування) === -->
  <div id="signFormModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('signFormModal')">✖</span>
        <h3 id="formTitle">Додати/Редагувати знак</h3>
        <input type="hidden" id="signId"> <!-- Приховане поле для ID -->

        <input type="text" id="signName" placeholder="Назва знака">
        <input type="text" id="signCategory" placeholder="Категорія (напр. Заборонні)">
        <textarea id="signDescription" placeholder="Опис та правила застосування" rows="5" style="width: 100%; margin: 8px 0; padding: 10px; border-radius: 8px;"></textarea>

        <button onclick="saveSign()" style="background: #27ae60;">Зберегти</button>
    </div>
  </div>

  <script src="app.js" defer></script>
</body>
</html>