# 0002 - Шарова Архітектура (Layered Architecture)

**Дата:** 26.10.2025
**Статус:** Прийнято

## 1. Контекст

Виходячи з рішення про Модульний Моноліт (ADR-0001), необхідно чітко визначити відповідальність кожного шару для забезпечення чистої архітектури та можливості подальшого рефакторингу.

## 2. Рішення

Використовується класична **Тришарова Архітектура (Three-Tier Layered Architecture)**: API, Service (Use Cases) та Domain (Model/Repository).

| Шар (Папка) | Відповідальність | Приклад коду | Залежності |
| :--- | :--- | :--- | :--- |
| **API** (`app.py` / `routes`) | HTTP/JSON. Приймає запит, валідує DTO, викликає Service, мапить Domain Model у Response DTO. | `@app.route('/signs', methods=['POST'])` | Service |
| **Service** (`services/`) | Бізнес-логіка, координація операцій, валідація, транзакції, мапінг DTO ↔ Domain. | `SignService.create_sign(...)` | Domain, Repository |
| **Domain** (`domain/`) | Сутності, Value Objects, інваріанти. Знає, як змінити власний стан. | `RoadSign.update_description(...)` | Не залежить ні від кого |
| **Repository** (`repositories/`) | Зберігання та відновлення Domain Entities (SQL, NoSQL). | `SignRepository.get_by_id(...)` | Domain, Infrastructure (DB) |

## 3. Правила Залежностей

1.  **Напрямок зверху вниз:** API залежить від Service, Service залежить від Domain/Repository. Зворотні залежності (наприклад, Service від API) **заборонені**.
2.  **Заборонені прямі зв'язки:** API **ніколи** не звертається безпосередньо до БД або Репозиторію. Всі операції проходять через Service.
3.  **Логіка:** Вся бізнес-логіка (правила, перевірки) має жити або в **Domain** (для інваріантів сутності), або в **Service** (для координації).